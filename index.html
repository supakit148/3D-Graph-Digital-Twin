<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Digital Twin 3D Neon Dashboard – Fullscreen Stretch Max</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
  html, body {
    height: 100%;
    margin: 0;
    overflow: hidden;
    background: #000;
    font-family: 'Orbitron', sans-serif;
    color: #0ff;
    display: flex;
    flex-direction: column;
  }

  .controls {
    display: flex;
    gap: 14px;
    padding: 12px;
    flex-wrap: wrap;
    background: #111a;
    border-radius: 0 0 12px 12px;
    align-items: center;
    width: 100vw;
    box-shadow: 0 0 25px rgba(0,255,255,.3);
    z-index: 10;
  }

  select, button {
    background: #000;
    color: #0ff;
    border: 1px solid #0ff;
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
  }

  #dashboard3D {
    flex: 1;
    width: 100vw;
    border-top: 1px solid rgba(0,255,255,0.2);
    border-bottom: 1px solid rgba(0,255,255,0.2);
    box-shadow: 0 0 40px rgba(0,255,255,0.15) inset;
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  }

  .floor-group {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    padding: 6px 8px;
    border: 1px dashed #00ffff66;
    border-radius: 10px;
    background: rgba(0,0,0,0.35);
  }

  .floor-chip {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #0ff6;
    background: rgba(0,255,255,0.08);
    box-shadow: 0 0 10px #00ffff22 inset;
  }

  .floor-chip input {
    accent-color: #00ffff;
    transform: scale(1.1);
    cursor: pointer;
  }

  #legendToggle, #fullscreenBtn { margin-left: auto; }

  @media (max-width: 768px) {
    .controls { border-radius: 0; }
  }
</style>
</head>
<body>

<div class="controls" id="controlsBar">
  <div class="floor-group" id="floorChecks">
    <span class="label-title">Floors:</span>
    <label class="floor-chip"><input type="checkbox" id="floor_all" checked> All Floors</label>
    <label class="floor-chip"><input type="checkbox" class="floor-item" value="1st_Floor" checked> 1st</label>
    <label class="floor-chip"><input type="checkbox" class="floor-item" value="M_Floor" checked> M</label>
    <label class="floor-chip"><input type="checkbox" class="floor-item" value="2nd_Floor" checked> 2nd</label>
    <label class="floor-chip"><input type="checkbox" class="floor-item" value="3rd_Floor" checked> 3rd</label>
    <label class="floor-chip"><input type="checkbox" class="floor-item" value="4th_Floor" checked> 4th</label>
    <label class="floor-chip"><input type="checkbox" class="floor-item" value="5th_Floor" checked> 5th</label>
  </div>

  <select id="systemSelect">
    <option value="ALL">All Systems</option>
    <option value="CCTV">CCTV</option>
    <option value="Electrical">Electrical</option>
    <option value="Water">Water</option>
    <option value="Air">Air</option>
  </select>

  <select id="paramSelect">
    <option value="ALL">All Parameters</option>
  </select>

  <button id="legendToggle">Hide Legend</button>
  <button id="fullscreenBtn">⛶ Fullscreen</button>
</div>

<div id="dashboard3D"></div>

<script>
/* ====== Config ====== */
const parameters = {
  CCTV: ["Offline","Online","Intruder","Total"],
  Electrical: ["Voltage","Current","Power","Frequency"],
  Water: ["Flow Rate","Water Usage","Duration (Months)","Duration (Days)"],
  Air: ["Temperature","Humidity","PM2.5","PM10","CO2","TVOC","CH2O"]
};
const floors = ["1st_Floor","M_Floor","2nd_Floor","3rd_Floor","4th_Floor","5th_Floor"];
const neonPalette = ["#00FFFF","#7DF9FF","#8A2BE2","#FF00FF","#00FF7F","#FF1493","#1E90FF","#00CED1"];
const pointsPerTrace = 24 * 3;
const xAxisValues = [...Array(pointsPerTrace).keys()];

/* ====== Random data generator ====== */
function generateData(param){
  const base={
    "Offline":[0,5],"Online":[5,20],"Intruder":[0,2],"Total":[5,20],
    "Voltage":[210,230],"Current":[1,30],"Power":[0.5,10],"Frequency":[49,51],
    "Flow Rate":[0,1],"Water Usage":[10,100],"Duration (Months)":[1,12],"Duration (Days)":[1,30],
    "Temperature":[22,28],"Humidity":[40,60],"PM2.5":[5,25],"PM10":[10,50],
    "CO2":[400,800],"TVOC":[0,1],"CH2O":[0,0.1]
  };
  const [min,max]=base[param]||[0,50];
  return Array.from({length:pointsPerTrace},()=>+(Math.random()*(max-min)+min).toFixed(2));
}

/* ====== Traces ====== */
let data3D=[];
floors.forEach(floor=>{
  Object.keys(parameters).forEach(system=>{
    parameters[system].forEach((param,i)=>{
      const color=neonPalette[i%neonPalette.length];
      data3D.push({
        x:xAxisValues,
        y:Array(pointsPerTrace).fill(floor),
        z:generateData(param),
        mode:'lines',
        type:'scatter3d',
        name:`${floor} - ${param} - ${system}`,
        line:{width:4,color},
        visible:true
      });
    });
  });
});

/* ====== Layout ====== */
let layout3D = {
  paper_bgcolor:'rgba(0,0,0,0)',
  plot_bgcolor:'rgba(0,0,0,0)',
  showlegend:true,
  scene:{
    xaxis:{title:'Hour',color:'#0ff',gridcolor:'rgba(0,255,255,0.2)',range:[0,pointsPerTrace-1]},
    yaxis:{title:'Floor',color:'#0ff',gridcolor:'rgba(0,255,255,0.2)'},
    zaxis:{title:'Value',color:'#0ff',gridcolor:'rgba(0,255,255,0.2)'},
    aspectmode:'manual',
    aspectratio:{x:3.8,y:1,z:1}, // เริ่มต้นยืดมาก
    camera:{eye:{x:4.5,y:3,z:1.8}}
  },
  margin:{l:0,r:0,b:0,t:0},
  legend:{
    orientation:'h',
    x:0.5,xanchor:'center',y:-0.05,
    font:{color:'#0ff'},
    bgcolor:'rgba(0,0,0,0)'
  }
};

/* ====== Initial Render ====== */
Plotly.newPlot('dashboard3D',data3D,layout3D,{responsive:true,displayModeBar:true});

/* ====== Resize dynamically ====== */
function adjustSize(){
  const chart = document.getElementById('dashboard3D');
  const controls = document.getElementById('controlsBar');
  const vH = window.innerHeight - controls.getBoundingClientRect().height;
  chart.style.height = `${vH}px`;
  chart.style.width = '100vw';

  const ratio = window.innerWidth / vH;
  const xStretch = Math.min(6.5, Math.max(3.5, ratio * 1.8)); // ยืดสุดแต่ไม่บิด
  Plotly.relayout(chart, {
    'scene.aspectratio': {x:xStretch, y:1, z:1},
    'scene.camera.eye': {x:xStretch * 1.2, y:2.6, z:1.6}
  });
  Plotly.Plots.resize(chart);
}
window.addEventListener('load', adjustSize);
window.addEventListener('resize', adjustSize);

/* ====== Filter Controls ====== */
function updateVisibility(){
  const selSys=systemSelect.value;
  const selParam=paramSelect.value;
  const selectedFloors=new Set(
    Array.from(document.querySelectorAll('.floor-item'))
      .filter(cb=>cb.checked)
      .map(cb=>cb.value)
  );
  data3D.forEach(trace=>{
    const [floor,param,system]=trace.name.split(' - ');
    trace.visible=
      selectedFloors.has(floor)&&
      (selSys==='ALL'||system===selSys)&&
      (selParam==='ALL'||param===selParam);
  });
  Plotly.react('dashboard3D',data3D,layout3D,{responsive:true,displayModeBar:true});
  adjustSize();
}
systemSelect.addEventListener('change',updateVisibility);
paramSelect.addEventListener('change',updateVisibility);
document.querySelectorAll('.floor-item, #floor_all').forEach(cb=>{
  cb.addEventListener('change',updateVisibility);
});

/* ====== Legend Toggle ====== */
document.getElementById('legendToggle').addEventListener('click',()=>{
  layout3D.showlegend=!layout3D.showlegend;
  document.getElementById('legendToggle').textContent=layout3D.showlegend?'Hide Legend':'Show Legend';
  Plotly.relayout('dashboard3D',{showlegend:layout3D.showlegend});
});

/* ====== Fullscreen Toggle ====== */
const fsBtn=document.getElementById('fullscreenBtn');
fsBtn.addEventListener('click',()=>{
  const elem=document.documentElement;
  if(!document.fullscreenElement){
    elem.requestFullscreen();
    fsBtn.textContent='✕ Exit Fullscreen';
  }else{
    document.exitFullscreen();
    fsBtn.textContent='⛶ Fullscreen';
  }
  setTimeout(adjustSize,100);
});
</script>
</body>
</html>
